{"id":4366,"date":"2024-11-26T17:59:39","date_gmt":"2024-11-26T17:59:39","guid":{"rendered":"https:\/\/help.perfexcrm.com\/?p=4366"},"modified":"2024-11-26T18:04:17","modified_gmt":"2024-11-26T18:04:17","slug":"configure-email-with-microsoft-azure-and-oauth-2","status":"publish","type":"post","link":"https:\/\/help.perfexcrm.com\/configure-email-with-microsoft-azure-and-oauth-2\/","title":{"rendered":"Configure email with Microsoft Azure and OAUTH 2"},"content":{"rendered":"\n<p>Starting from version 3.0.5, you can configure a general Microsoft email using OAuth2, to do this on your Perfex CRM installation follow the steps below, note that you will need to create an <a href=\"https:\/\/portal.azure.com\/#view\/Microsoft_AAD_RegisteredApps\/ApplicationsListBlade\" target=\"_blank\" rel=\"noopener\" title=\"Azure application\">Azure application<\/a> and authorize it in the Perfex CRM email configuration section at<strong> Setup -&gt; Settings-&gt; Email<\/strong><\/p>\n\n\n<div class=\"st-alert st-alert- \">Microsoft Azure client secrets expires after a maximum of between 3 and 24 months (you can select the length yourself).<br \/>\n<br \/>\nIf your authentication suddenly doesn&#8217;t work anymore, please check the if the Client Secret has expired.<br \/>\n<\/div>\n\n\n\n<h3 class=\"wp-block-heading\">Notes<\/h3>\n\n\n\n<ul class=\"wp-block-list\">\n<li><strong>New App Registration Requirement<\/strong>: As of the update, personal Microsoft accounts (e.g., @outlook.com, @hotmail.com) cannot register apps outside of a directory. Ensure you are working within an AAD tenant.<\/li>\n\n\n\n<li><strong>OAuth Consent<\/strong>: Users may need to authorize your app the first time they use it.<\/li>\n<\/ul>\n\n\n\n<p>For more detailed information, refer to <a href=\"https:\/\/learn.microsoft.com\/en-us\/answers\/questions\/1663127\/question-regarding-notification-about-being-requir\">Microsoft Documentation<\/a>.<\/p>\n\n\n\n<h3 class=\"wp-block-heading\">Steps<\/h3>\n\n\n\n<h4 class=\"wp-block-heading\">1. Register an Application in Azure Active Directory<\/h4>\n\n\n\n<ul class=\"wp-block-list\">\n<li>Log in to the <strong>Azure Portal<\/strong>: <a href=\"https:\/\/portal.azure.com\">https:\/\/portal.azure.com<\/a>.<\/li>\n\n\n\n<li>Navigate to <strong>Azure Active Directory<\/strong> &gt; <strong><a href=\"https:\/\/portal.azure.com\/#view\/Microsoft_AAD_RegisteredApps\/ApplicationsListBlade\" title=\"\">App Registrations<\/a><\/strong>.<\/li>\n\n\n\n<li>Click <strong>+ New Registration<\/strong>.<\/li>\n\n\n\n<li>Provide:\n<ul class=\"wp-block-list\">\n<li><strong>Name<\/strong>: Enter a recognizable name (e.g., Perfex CRM Email Integration).<\/li>\n\n\n\n<li>Select who should be able to use this application:<\/li>\n\n\n\n<li><strong>Supported Account Types<\/strong>: Select who should be able to use this application:\n<ul class=\"wp-block-list\">\n<li><strong>Accounts in this organizational directory only<\/strong> (Single tenant) for internal use.<\/li>\n\n\n\n<li><strong>Accounts in any organizational directory<\/strong> (Multi-tenant) if you want to support other AAD tenants.<\/li>\n\n\n\n<li>If you are not sure about this option, select: <strong>Accounts in any organizational directory (Any Microsoft Entra ID tenant &#8211; Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)<\/strong><\/li>\n<\/ul>\n<\/li>\n\n\n\n<li><strong>Redirect URI<\/strong>: Enter https:\/\/perfex-crm-url.com\/admin\/smtp_oauth_microsoft\/token.<\/li>\n\n\n\n<li><em>Ensure to replace perfex-crm-url.com with your Perfex CRM installation.<\/em><\/li>\n\n\n\n<li>Ensure <strong>Web <\/strong>is select in the redirect URI dropdown.<\/li>\n<\/ul>\n<\/li>\n\n\n\n<li>Click <strong>Register<\/strong>.<\/li>\n<\/ul>\n\n\n\n<h4 class=\"wp-block-heading\">2. Configure API Permissions<\/h4>\n\n\n\n<ul class=\"wp-block-list\">\n<li>Go to <strong>API Permissions<\/strong> in your app&#8217;s settings <em>(Manage -&gt; Certificates &amp; secrets)<\/em>.<\/li>\n\n\n\n<li>Click <strong>+ Add a permission<\/strong>.<\/li>\n\n\n\n<li>Select <strong>Microsoft Graph<\/strong> &gt; <strong>Delegated permissions<\/strong>.<\/li>\n<\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"402\" src=\"https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-add-permissions-1024x402.png\" alt=\"\" class=\"wp-image-4369\" srcset=\"https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-add-permissions-1024x402.png 1024w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-add-permissions-300x118.png 300w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-add-permissions-768x302.png 768w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-add-permissions-60x24.png 60w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-add-permissions-150x59.png 150w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-add-permissions.png 1313w\" sizes=\"auto, (max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ul class=\"wp-block-list\">\n<li>Add the following permissions:\n<ul class=\"wp-block-list\">\n<li><mark style=\"background-color:#8ed1fc\" class=\"has-inline-color has-black-color\">offline_access<\/mark><\/li>\n\n\n\n<li><mark style=\"background-color:#8ed1fc\" class=\"has-inline-color has-black-color\">SMTP.Send<\/mark><\/li>\n<\/ul>\n<\/li>\n\n\n\n<li>(Optional) If admin consent is required, click <strong>Grant admin consent<\/strong> and confirm.<\/li>\n<\/ul>\n\n\n\n<h4 class=\"wp-block-heading\">3. Set Up Secret<\/h4>\n\n\n\n<ul class=\"wp-block-list\">\n<li>In your app, go to <strong>Certificates &amp; secrets<\/strong> <em>(Manage -&gt; Certificates &amp; secrets)<\/em>.<\/li>\n\n\n\n<li>Click <strong>+ New client secret<\/strong>.<\/li>\n\n\n\n<li>Add a description (e.g., <em>Perfex CRM Secret<\/em>) and choose an expiration period.<\/li>\n\n\n\n<li>Click <strong>Add<\/strong> and copy the <strong>Value<\/strong>. This is your <strong>Client Secret<\/strong>.<\/li>\n<\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"414\" src=\"https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-client-secret-value-1024x414.png\" alt=\"\" class=\"wp-image-4368\" srcset=\"https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-client-secret-value-1024x414.png 1024w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-client-secret-value-300x121.png 300w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-client-secret-value-768x310.png 768w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-client-secret-value-60x24.png 60w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-client-secret-value-150x61.png 150w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2024\/11\/azure-client-secret-value.png 1300w\" sizes=\"auto, (max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<h4 class=\"wp-block-heading\">4. Note Key Details<\/h4>\n\n\n\n<p>Save the following information for Perfex CRM configuration:<\/p>\n\n\n\n<ul class=\"wp-block-list\">\n<li><strong>Application (client) ID<\/strong>: Found on the app&#8217;s Overview page.<\/li>\n\n\n\n<li><strong>Directory (tenant) ID<\/strong> (<em><mark style=\"background-color:rgba(0, 0, 0, 0);color:#a9a9a9\" class=\"has-inline-color\">if applicable<\/mark><\/em>): Found on the app&#8217;s Overview page.<\/li>\n\n\n\n<li><strong>Client Secret<\/strong>: Copied from the previous step.<\/li>\n<\/ul>\n\n\n\n<h4 class=\"wp-block-heading\">5. Enable Email Sending in Perfex CRM<\/h4>\n\n\n\n<ul class=\"wp-block-list\">\n<li>Log in to Perfex CRM.<\/li>\n\n\n\n<li>Navigate to <strong>Setup -&gt; Settings -&gt; Email<\/strong>.<\/li>\n\n\n\n<li>Select <strong>Microsoft Azure XOAUTH2<\/strong> as the email protocol.<\/li>\n\n\n\n<li>Ensure <strong>Mail Engine<\/strong> is set to <strong>PHPMailer<\/strong>.&nbsp;<\/li>\n\n\n\n<li>Ensure the <strong>Email Protocol<\/strong> is set to <strong>Microsoft OAuth 2.0<\/strong>.<\/li>\n\n\n\n<li>Enter the following:\n<ul class=\"wp-block-list\">\n<li><strong>Client ID<\/strong>: Your Application (client) ID.<\/li>\n\n\n\n<li><strong>Client Secret<\/strong>: Your Client Secret.<\/li>\n\n\n\n<li><strong>Tenant ID<\/strong>: Your Directory (tenant) ID (<em><mark style=\"background-color:rgba(0, 0, 0, 0);color:#a9a9a9\" class=\"has-inline-color\">if applicable<\/mark><\/em>).<\/li>\n\n\n\n<li><strong>SMTP Host<\/strong>: smtp.office365.com.<\/li>\n\n\n\n<li><strong>SMTP Port<\/strong>: 587.<\/li>\n\n\n\n<li><strong>Encryption<\/strong>: TLS.<\/li>\n\n\n\n<li><strong>Email<\/strong>: The e-mail address you will use to send emails from Perfex CRM, usually this is the e-mail address associated with the Azure application.<\/li>\n<\/ul>\n<\/li>\n<\/ul>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Starting from version 3.0.5, you can configure a general Microsoft email using OAuth2, to do this on your Perfex CRM installation follow the steps below, note that you will need to create an Azure application and authorize it in the Perfex CRM email configuration section at Setup -&gt; Settings-&gt; Email Notes For more detailed information, [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[25],"tags":[],"class_list":["post-4366","post","type-post","status-publish","format-standard","hentry","category-email-config-and-templates"],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts\/4366","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/comments?post=4366"}],"version-history":[{"count":0,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts\/4366\/revisions"}],"wp:attachment":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/media?parent=4366"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/categories?post=4366"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/tags?post=4366"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}