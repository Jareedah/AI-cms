{"id":4114,"date":"2019-03-24T18:15:58","date_gmt":"2019-03-24T18:15:58","guid":{"rendered":"https:\/\/help.perfexcrm.com\/?p=4114"},"modified":"2019-04-01T17:20:22","modified_gmt":"2019-04-01T17:20:22","slug":"preparing-module-upgrade","status":"publish","type":"post","link":"https:\/\/help.perfexcrm.com\/preparing-module-upgrade\/","title":{"rendered":"Preparing Module Upgrade"},"content":{"rendered":"\n<p>To resolve an issue or improve your module, you want to create updates for your module so your customers can benefit from the enhancements.<\/p>\n\n\n\n<p>Perfex CRM will determine whether there is a new upgrade for your module by the init file <a href=\"https:\/\/help.perfexcrm.com\/module-file-headers\/\">version header<\/a>.<\/p>\n\n\n\n<p>For example, you released a version 1.0.0 and the users are using this version, at the time the user will install your 1.0.0 version and and activate the module, Perfex CRM will store the activated module version number in database.<\/p>\n\n\n\n<p>Then you release version 1.1.0 and the user re-upload\/install the module files, Perfex CRM will determine that <strong>the version from the file header is not the same like the one stored in the database and will show a message to the user to upgrade the database.<\/strong><\/p>\n\n\n\n<figure class=\"wp-block-image\"><img loading=\"lazy\" decoding=\"async\" width=\"983\" height=\"440\" src=\"https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2019\/03\/migration-module.png\" alt=\"\" class=\"wp-image-4116\" srcset=\"https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2019\/03\/migration-module.png 983w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2019\/03\/migration-module-300x134.png 300w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2019\/03\/migration-module-768x344.png 768w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2019\/03\/migration-module-60x27.png 60w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2019\/03\/migration-module-150x67.png 150w\" sizes=\"auto, (max-width: 983px) 100vw, 983px\" \/><\/figure>\n\n\n\n<p>Perfex CRM modules migration extends the CodeIgniter framework migration library and uses the <strong>Sequential<\/strong> migration type, keep in mind that there is no ability to change the Sequential type to Timestamp.<\/p>\n\n\n\n<p>If you are not familiar with the CodeIgniter migration library, the best is to check their <a href=\"https:\/\/www.codeigniter.com\/user_guide\/libraries\/migration.html\">documentation<\/a>.<\/p>\n\n\n\n<p>Each migration is numbered in sequence, starting with <strong>001<\/strong>. Each number must be three digits, and there must not be any gaps in the sequence.<\/p>\n\n\n\n<p>Create (if not exists) a folder name <strong>migrations<\/strong> in the module directory, after you create the folder the location will be: <strong>modules\/[module-name]\/migrations<\/strong><\/p>\n\n\n\n<p>For our example, you must create a migration file e.q.  <strong>110_version_110.php<\/strong> with the following contents:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>&lt;?php\n\ndefined('BASEPATH') or exit('No direct script access allowed');\n\nclass Migration_Version_110 extends App_module_migration\n{\n    public function up()\n    {\n        \/\/ Perform database upgrade here\n    }\n}\n<\/code><\/pre>\n\n\n\n<p>The <strong>110_version_110.php<\/strong> file will perform an upgrade for your module version  <strong>1.1.0.<\/strong><\/p>\n\n\n\n<p>Keep in mind that <strong>in your activation hook<\/strong>, <strong>you still must have the latest changes for the database<\/strong>, the migration files will run only for existing installation who are using an older version, the new module installation must get these DB changes from the install hook.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\">Caveats<\/h2>\n\n\n\n<h3 class=\"wp-block-heading\">Downgrade<\/h3>\n\n\n\n<p>There is no ability to downgrade to previous versions, for this reason, always just add the <strong>up<\/strong> method in your migration files.<\/p>\n\n\n\n<h3 class=\"wp-block-heading\">Create m<g class=\"gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep\" id=\"6\" data-gr-id=\"6\">igration<\/g> file whenever the module header version is changed.<\/h3>\n\n\n\n<p><strong>You must create a migration file each time you change the module version number even if there are no changes in the database.<\/strong><\/p>\n\n\n\n<p>Perfex CRM can&#8217;t determine if you have or not have a database upgrades but the migration file must be executed in order just to upgrade the version number in database.<\/p>\n\n\n\n<p>In cases like this when there <g class=\"gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar multiReplace\" id=\"4\" data-gr-id=\"4\">is<\/g> no queries to perform in the migration file, just <strong>leave the<\/strong> <strong>method<\/strong> <strong>up<\/strong> <strong>empty<\/strong> e.q. as shown in the example above.<\/p>\n\n\n\n<p>The user will see that there is database upgrade required, will click &#8220;Upgrade Database&#8221;, an empty migration will run and the database number will be successfully updated.<\/p>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>To resolve an issue or improve your module, you want to create updates for your module so your customers can benefit from the enhancements. Perfex CRM will determine whether there is a new upgrade for your module by the init file version header. For example, you released a version 1.0.0 and the users are using [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[54],"tags":[],"class_list":["post-4114","post","type-post","status-publish","format-standard","hentry","category-modules"],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts\/4114","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/comments?post=4114"}],"version-history":[{"count":0,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts\/4114\/revisions"}],"wp:attachment":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/media?parent=4114"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/categories?post=4114"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/tags?post=4114"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}