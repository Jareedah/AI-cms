{"id":235,"date":"2017-02-12T09:17:10","date_gmt":"2017-02-12T09:17:10","guid":{"rendered":"https:\/\/help.perfexcrm.com\/?p=235"},"modified":"2021-02-19T12:12:43","modified_gmt":"2021-02-19T12:12:43","slug":"email-piping-auto-importing-tickets","status":"publish","type":"post","link":"https:\/\/help.perfexcrm.com\/email-piping-auto-importing-tickets\/","title":{"rendered":"Email Piping \/ Auto Importing Tickets"},"content":{"rendered":"\n<p>Email Piping is a feature in Perfex CRM to auto open or <g class=\"gr_ gr_7 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar multiReplace\" id=\"7\" data-gr-id=\"7\">reply<\/g> to ticket from email.<\/p>\n\n\n\n<p><span style=\"color: #000000;\"><div class=\"st-alert st-alert-danger \">You can&#8217;t use both methods for auto importing tickets. You need to configure only 1 method (cPanel Forwarders or IMAP) depends on your requirements.<\/div><\/span><\/p>\n\n\n\n<ul class=\"wp-block-list\"><li>On your mail server you must create a <strong><span style=\"color: #ff0000;\">unique email<\/span> account for each support department<\/strong>, this must be a full inbox.<\/li><li>In Perfex&nbsp;navigate to <b>Setup -&gt; Support -&gt; Departments &gt; Edit<\/b> and enter your email&nbsp;address for this department.<\/li><\/ul>\n\n\n\n<h3 class=\"wp-block-heading\">Email forwarders method (cPanel Method 1)<\/h3>\n\n\n\n<ol class=\"wp-block-list\"><li>Login to you cPanel account<\/li><li>Go to Forwarders section and setup forwarder using the following command based on your department &#8220;<strong>php -q \/home\/username\/public_html\/crm\/pipe.php<\/strong>&#8221; . Eq. If you department is Info and you setup info@yourdomain.com as email in the department you should forward this email. <strong>Repeat this step for each department.<\/strong><\/li><\/ol>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter\"><img loading=\"lazy\" decoding=\"async\" width=\"768\" height=\"750\" src=\"https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2017\/02\/email-piping-perfex-768x750.png\" alt=\"Email Piping, cPanel Forwarders\" class=\"wp-image-236\" srcset=\"https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2017\/02\/email-piping-perfex-768x750.png 768w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2017\/02\/email-piping-perfex-768x750-300x293.png 300w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2017\/02\/email-piping-perfex-768x750-60x60.png 60w, https:\/\/help.perfexcrm.com\/wp-content\/uploads\/2017\/02\/email-piping-perfex-768x750-150x146.png 150w\" sizes=\"auto, (max-width: 768px) 100vw, 768px\" \/><\/figure><\/div>\n\n\n<div class=\"st-alert st-alert-success \">TIP: You can check the pipe path into Setup -&gt; Settings -&gt; Tickets -&gt; Email Piping.<\/div>\n\n\n\n<hr class=\"wp-block-separator\"\/>\n\n\n\n<h3 class=\"wp-block-heading\">IMAP&nbsp; (Method 2)<\/h3>\n\n\n\n<p>This method auto import tickets directly reading&nbsp;your email.<\/p>\n\n\n\n<ul class=\"wp-block-list\"><li>If you want to use this method you need to have setup <a href=\"https:\/\/help.perfexcrm.com\/setup-cpanel-cron-job\/\">cron job.<\/a><\/li><li><strong>The cron will run each 5 minutes and will check for new tickets.<\/strong><\/li><\/ul>\n\n\n\n<p><strong>NOTE: <\/strong>The script <strong>will check only non-opened emails<\/strong> to prevent checking all the emails again and again and avoid&nbsp;slowing down the system. After checking email if you don&#8217;t have checked delete after import the script <strong>will auto mark the email as READ.<\/strong><\/p>\n\n\n<div class=\"st-alert st-alert-danger \"><strong> If you are setup existing email address that has a lot of emails make sure that all emails are marked as READ to prevent importing spam emails when the cron job will run and read your emails the first time.<\/strong><\/div>\n\n\n\n<p>Your PHP build <strong>needs IMAP<\/strong> support for this method to function correctly.<\/p>\n\n\n\n<ol class=\"wp-block-list\"><li>On your mail server create a unique email account for each support department. This must be full inbox alias email is not supported.<\/li><li>Navigate to Setup-&gt;Support-&gt;Departments for each department add your IMAP credentials, click test IMAP connection to test if the connection is successful and your credentials are good.<\/li><li>Follow the test steps mentioned below.<\/li><\/ol>\n\n\n\n<h4 class=\"wp-block-heading\"><strong>Gmail IMAP Auto Import Notes<\/strong><\/h4>\n\n\n\n<ol class=\"wp-block-list\"><li>If you are using google apps account make sure you verified your domain name.<\/li><li>If you are using google apps account make sure you enable IMAP.<\/li><li>If you get connection refused while testing IMAP connection check that your server&#8217;s firewall isn&#8217;t blocking traffic to Google.<\/li><li>Make sure you have enabled<a href=\"https:\/\/support.google.com\/accounts\/answer\/6010255?hl=en-GB\"> less secure apps<\/a><\/li><li>For IMAP&nbsp;server try <strong>imap.gmail.com<\/strong><\/li><li>Check <strong>encryption SSL<\/strong><\/li><\/ol>\n\n\n\n<p>To control\/block any <strong>spam emails<\/strong> you should visit <strong>Setup-&gt;Support-&gt;Spam&nbsp;Filters<\/strong>.<\/p>\n\n\n\n<hr class=\"wp-block-separator\"\/>\n\n\n\n<h3 class=\"wp-block-heading\" id=\"testing_piping\">Testing the Email Piping<\/h3>\n\n\n<div class=\"st-alert st-alert-info \">If you are using the IMAP auto importing tickets method you will need to wait 5 minutes the cron job to run.<\/div>\n\n\n\n<p>After you set up, try sending some test email. If everything is good a new ticket will be opened inside the CRM. <strong>While testing you should not use your or any staff address to send a message. <\/strong><\/p>\n\n\n\n<p><strong>Staff email addresses are only for ticket replies only and you cant create a new ticket with staff email.<\/strong><\/p>\n\n\n\n<p>Should a ticket not be created when sending in an email, then check in <strong>Utilities &gt; Ticket Pipe Log<\/strong>. If the message was received by Perfex&nbsp;it will be listed here with the reason why it failed to create a ticket. If the message you sent is not listed here, then the forwarder you set up previously is not working correctly and Perfex&nbsp;didn&#8217;t receive the message.<\/p>\n\n\n\n<p>If you get the error message &#8220;<strong>Ticket ID Not Found<\/strong>&#8221; this means you are trying to open a support ticket from your staff email address.<\/p>\n\n\n\n<p><strong>Staff can only reply to tickets, not open new ones so submit a ticket from any other email address and it should be accepted.<\/strong><\/p>\n\n\n\n<h3 class=\"wp-block-heading\" id=\"known_issues\">Known problems you can encounter<\/h3>\n\n\n\n<p>If an email has not been piped into the ticket system the first reference point is <b>Utilities &gt; Ticket Pipe Log<\/b>. This shows all the emails processed by the Perfex&nbsp;email piping process and any errors that may have occurred, explanations of the three most common errors are below:<\/p>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"ticket_id_not_found\">Ticket ID Not Found<\/h4>\n\n\n\n<p>This means you are using an email address assigned to staff&nbsp;to send your email. Staff can only reply to tickets&nbsp;and cant open new tickets sending an email to the support emails.<br>If you want to test, you must send an email from an email address that is not assigned to staff into Perfex.<\/p>\n\n\n\n<h4 class=\"wp-block-heading\">Only Replies Allowed by Email<\/h4>\n\n\n\n<p>The log means that an email was received to the department email address, but the subject did not contain a ticket ID. If you have set to Yes&nbsp;<strong>Only Replies Allowed by Email<\/strong> option located in&nbsp;Setup -&gt; Settings -&gt; Support-&gt;Email Piping config&nbsp;the email is rejected from the system.<\/p>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"inline-attachments\"><strong>Inline attachment not included in ticket body (cPanel forwarder method)<\/strong><\/h4>\n\n\n\n<p>Sometimes it&#8217;s not possible for us to fetch the inline attachments from the email body and include in the ticket. Only regular attachments will be imported.<\/p>\n\n\n\n<h4 class=\"wp-block-heading\"><strong>New Tickets\/Replies are Imported Twice<\/strong><\/h4>\n\n\n\n<div>Make sure that you are not using IMAP and cPanel forwarder method together, you should either use IMAP <strong>OR<\/strong> cPanel forwarder to auto import tickets.<\/div>\n\n\n\n<div>If you are using the pipe.php (cPanel forwarder method), can you navigate to Setup-&gt;Support-&gt;Departments and make sure that in your departments the IMAP host and password are blank.<\/div>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"staff_not_receiving_emails\"><strong>Staff members not receiving an email when a new ticket is created or reply is posted<\/strong><\/h4>\n\n\n\n<p>Click <a href=\"https:\/\/help.perfexcrm.com\/staff-members-not-receiving-email-when-new-ticket-is-created-or-reply-is-posted\/\">here<\/a> to read more about the reason why this is happening.<\/p>\n\n\n\n<h3 class=\"wp-block-heading\">Troubleshooting<\/h3>\n\n\n\n<p>If an email has not been piped into the ticket system and it is not listed in the <b>Utilities &gt; Email Pipe Log<\/b> then these steps can be followed to identify the cause of the problem. There are different procedures depending upon whether the email forwarder&nbsp;piping method is used.<\/p>\n\n\n\n<h4 class=\"wp-block-heading\">No Log outputted in the Email Pipe Log or Getting Mail Delivery<\/h4>\n\n\n\n<p>If no email pipe log when sending an email to your piped email address then the forwarder entry is not correct and the message is not being sent to the pipe.php file.<\/p>\n\n\n\n<p>To correct this, first ensure the pipe.php file is <b>chmod to 755<\/b>.<\/p>\n\n\n\n<p>If still not working try one of the following commands:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/usr\/bin\/php -q \/home\/username\/public_html\/crm\/pipe.php \n\/usr\/local\/bin\/php -q \/home\/username\/public_html\/crm\/pipe.php <\/code><\/pre>\n","protected":false},"excerpt":{"rendered":"<p>Email Piping is a feature in Perfex CRM to auto open or reply to ticket from email. On your mail server you must create a unique email account for each support department, this must be a full inbox. In Perfex&nbsp;navigate to Setup -&gt; Support -&gt; Departments &gt; Edit and enter your email&nbsp;address for this department. [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[31,12],"tags":[],"class_list":["post-235","post","type-post","status-publish","format-standard","hentry","category-setup-and-configuration","category-support-tickets"],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts\/235","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/comments?post=235"}],"version-history":[{"count":0,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/posts\/235\/revisions"}],"wp:attachment":[{"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/media?parent=235"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/categories?post=235"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/help.perfexcrm.com\/wp-json\/wp\/v2\/tags?post=235"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}